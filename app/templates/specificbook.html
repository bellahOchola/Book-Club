<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Browse &mdash; Free Website Template by Free-Template.co</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="Free-Template.co" />


    <link rel="shortcut icon" href="{url_for('static', filename='ftco-32x32.png')}}">

    <link href="https://fonts.googleapis.com/css?family=Rubik:400,700" rel="stylesheet">

    <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">

    <link rel="stylesheet" href="{{url_for('static', filename='bootstrap.min.css')}}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="{{url_for('static', filename='magnific-popup.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='jquery-ui.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='owl.carousel.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='owl.theme.default.min.css')}}">

    <link rel="stylesheet" href="{{url_for('static', filename='bootstrap-datepicker.css')}}">

    <link rel="stylesheet" href="{{url_for('static', filename='flaticon.css')}}">

    <link rel="stylesheet" href="{{url_for('static', filename='aos.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='rangeslider.css')}}">

    <link rel="stylesheet" href="{{url_for('static', filename='stylestop.css')}}">

    <link rel="stylesheet" href="../static/chat.css">

  </head>
  <body>

  <div class="site-wrap">

    <div class="site-mobile-menu">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div>

    <header class="site-navbar" role="banner">

        <div class="container">
            <div class="row align-items-center">

              <div class="col-11 col-xl-2">
                <h1 class="mb-0 site-logo"><a href="{{url_for('main.index')}}" class="text-white h2 mb-0">Book Club</a></h1>
              </div>
              <div class="col-12 col-md-10 d-none d-xl-block">
                <nav class="site-navigation position-relative text-right" role="navigation">

                  <ul class="site-menu js-clone-nav mr-auto d-none d-lg-block">
                    <li><a href="{{url_for('main.index')}}"><span>Home</span></a></li>
                    <li class="has-children">
                        <a><span>More</span></a>
                        <ul class="dropdown arrow-top">

                          <li><a href="{{url_for('main.all_books_view')}}"><span>Archives</span></a></li>
                          <li><a href="#"><span>About</span></a></li>
                          <li><a href="#"><span>Contact</span></a></li>


                    {%if current_user.is_authenticated%}

                      <li class="nav-item">
                        <a href="{{url_for('main.user_books',uname=current_user.username)}}"><span>Profile</span></a></li>

                     {%endif%}

                        </ul>
                      </li>


                    {%if current_user.is_authenticated%}
                    <li class="nav-item">

                      <a><span>{{current_user.username | capitalize}}</span></a></li>



                    <li class="nav-item">
                      <a href="{{url_for('auth.logout')}}"><span>Sign out</span></a></li>

                {%else%}
                    <li class="nav-item">
                      <a href="{{url_for('auth.login')}}"><span>Sign in</span></a></li>
                {%endif%}


                  </ul>
                </nav>
              </div>


              <div class="d-inline-block d-xl-none ml-md-0 mr-auto py-3" style="position: relative; top: 3px;"><a href="#" class="site-menu-toggle js-menu-toggle text-white"><span class="icon-menu h3"></span></a></div>

              </div>

            </div>
      </div>

    </header>



    <div class="site-blocks-cover inner-page-cover overlay" style="background-image: url('https://images.unsplash.com/photo-1519791883288-dc8bd696e667?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&w=1000&q=80');" data-aos="fade" data-stellar-background-ratio="0.5">
      <div class="container">
        <div class="row align-items-center justify-content-center text-center">

          <div class="col-md-10" data-aos="fade-up" data-aos-delay="400">


            <div class="row justify-content-center">
              <div class="col-md-8 text-center">
                <h1> {{s_book.title}} by {{s_book.author}}</h1>

                <p>Posted on {{date}} by by {{s_book.user.username}}</p>
              </div>
            </div>


          </div>
        </div>
      </div>
    </div>

    <div class="site-section" style="padding-bottom: 10px;padding-top: 10px;">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">


            <h2 class="mb-5 text-primary">Book Details</h2>

            <div class="d-block d-md-flex listing-horizontal" style="padding-bottom: 10px;padding-top: 0px;">
                <p><img src="{{url_for('static',filename=s_book.photo) }}" alt="Image" width="100%" height="100%" style="margin-top: 20px; margin-left: 20px;" class="img-fluid mb-4"></p>

              <!-- <a href="#" class="img d-block" style="background-image: url('images/img_2.jpg')">
                <span class="category">{{s_book.title}}</span>
              </a> -->

              <div class="lh-content" style="margin-left: 20px;">
                <a href="#" class="bookmark"><span class="icon-heart"></span></a>
                <h3><a href="#"> {{s_book.title}} by {{s_book.author}}</a></h3>
                <p>
                  <span class="icon-star text-warning"></span>
                  <span class="icon-star text-warning"></span>
                  <span class="icon-star text-warning"></span>
                  <span class="icon-star text-warning"></span>
                  <span class="icon-star text-secondary"></span>
                  <span>(492 Reviews)</span>
                </p>


              </div>
              <!-- book description email -->
              <div>
                <p>{{s_book.description}}</p>
              </div>
            </div>

          </div>


        </div>
      </div>
    </div>
    <div style="margin-left: 8%;overflow-y: auto;max-height: 500px;max-width: 740px;">
      {% for message in chat %}
      <div id="content">
        <b>{{message.username}}</b>
        <p>{{message.message}}</p>

      </div>
      {% endfor %}
    </div>

    <div class="chat-popup" id="myForm" style="margin-left: 6%; width: 100%;">
        <form class="form-container" style="width: 30%;">
          <div>
            <div class="input-group-append" style="">
              <button class="btn btn-outline-secondary" type="button" value="{{ current_user.username }}" id="start_chat">Start chatting</button>
            </div>
          </div>

          <!-- ***************************** -->
          <div class="input-group mb-3" id="chat">
            <textarea  type="text" placeholder="Type message.." style="width: 100%; height: 20%;" name="msg" id="chat_text" aria-label="username" aria-describedby="button-addon2" required>
            </textarea>
            <div class="input-group-append">
              <button id="chat_btn" class="btn btn-outline-secondary" type="button">Post</button>
            </div>
          </div>

          <!-- style -->
          <style>
            #chat{
              display:none;
            }
          </style>
          <!-- ***************************** -->
        </form>
      </div>





  <script src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/jquery-migrate-3.0.1.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/jquery-ui.js')}}js/"></script>
  <script src="{{url_for('static', filename='js/popper.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/owl.carousel.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/jquery.stellar.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/jquery.countdown.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/jquery.magnific-popup.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/bootstrap-datepicker.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/aos.js')}}"></script>
  <script src="{{url_for('static', filename='js/rangeslider.min.js')}}"></script>


  <script src="{{url_for('static', filename='js/main.js')}}"></script>


  <script src="https://js.pusher.com/5.0/pusher.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
  <script src="../static/chat.js"></script>
  <script>
  $(function(){
          let username;
          $('#start_chat').on('click', function(){
              $('#chat').toggle();
              username = $('#start_chat').val();
          });
      $('#chat_btn').on('click', function(){
          message = $('#chat_text').val();
          $.post('/message', {'username': username, 'message' : message})

          window.location.reload();
      });


      // Enable pusher logging - don't include this in production
      Pusher.logToConsole = true;

      var pusher = new Pusher('516cc952f7e807a6d0b3', {
          cluster: 'ap2',
          forceTLS: true
      });
      var channel = pusher.subscribe('chat-channel')
      channel.bind('new-message', function(data) {
          let name = data.username;
          let message = data.message;
      let message_template = `
                              <div>
                                  <p>
                                      <b>${name}</b>
                                      <br> ${message}
                                  </p>
                              </div>`

          $('#content').append(message_template);
      });
  });
</script>


  </body>
</html>
